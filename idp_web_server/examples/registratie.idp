vocabulary environment {
    type Location := {Flemish_Region, Walloon_Region, Brussels_Region}
    type Real_Estate_Type := {Residential, Residential_Building_Land, Other_Real_Estate}
    type Destination := {As_Family_Dwelling, For_Resale, Community_Purpose, Social_Housing, Social_Renting, Other_House, No_House}
    type Buyer_Type := {Natural_Person, Legal_Person, Mixed}
    type Year := {2015..2025}
    type Agreement_Dwelling_For_Social_Renting := {Less_Than_9_years, More_than_9_Or_9_years}
    type Transaction := {Public_Sale, Out_Hand, Public_Sale_Community}
    type Resale := {Less_Than_Three, Three_Or_More}
    type Seller := {Vlaams_Woningfonds, Gelijksoortige_Rechtspersoon_EER, Mpy_Erkend_Door_VMSW, Vlaamse_Mpy_Voor_Sociaal_Wonen, Erkende_Sociale_Huisvestings_Mpy}

    [EN:the region] region : () ‚Üí Location


    // for Social_Dwelling
    [EN:the buyer] buyer : () ‚Üí Buyer_Type

    [EN:the value of the real estate] value: () ‚Üí ‚Ñù

    [EN:the seller] seller : () ‚Üí Seller
    mortgage_loan_allowance : () ‚Üí ùîπ

    // for Heritage
    [EN:the type of real estate] type_of_real_estate : () ‚Üí Real_Estate_Type
    [EN:the intended use] use : () ‚Üí Destination
    [EN:it is a monument] monument : () ‚Üí ùîπ
    [EN:it is an heritage investment] heritage_investment : () ‚Üí ùîπ
    [EN:it is part of an heritage plan] heritage_plan : () ‚Üí ùîπ
    [EN:additional terms are satisfied] additional_terms : () ‚Üí ùîπ

    // For Professional_Purchase
    [EN:the buyer is professional] professional_buyer : () ‚Üí ùîπ
    [EN:a professional declaration has been filed] professional_declaration_filed : () ‚Üí ùîπ
    [EN:the guarantee is satisfied] guarantee_satisfied : () ‚Üí ùîπ
    [EN:additional security is required] additional_security_required : () ‚Üí ùîπ
    [EN:additional security is provided] additional_security_satisfied : () ‚Üí ùîπ
    [EN:the number of resales] resale : () ‚Üí Resale
    [EN:the transaction type] transaction_type : () ‚Üí Transaction
    [EN:the date of certification of the sale] certification_date_sale : () ‚Üí Year

    // For Energy_Efficient_Dwelling
    [EN:it will be the domicile of the buyer] domicile_established : () ‚Üí ùîπ
    [EN:it is a clean purchase] clean_purchase : () ‚Üí ùîπ
    [EN:it is the first ownership of the buyer] first_ownership : () ‚Üí ùîπ
    [EN:there is a causal connection] causal_connection : () ‚Üí ùîπ
    [EN:energy-saving renovation is planned] energy_renovation_planned : () ‚Üí ùîπ
    [EN:the term of the energy-saving renovation] term_energy_renovation : () ‚Üí Year
    [EN:the date of certification] certification_date : () ‚Üí Year

    // For Dwelling_For_Social_Renting
    [EN:the date the social renting starts] start_dt_dwelling_for_social_rent : () ‚Üí Year
    [EN:the duration of the agreement] duration_of_agreement : () ‚Üí Agreement_Dwelling_For_Social_Renting

}

vocabulary decision {
    import environment

    type Registration_type := {Family_Dwelling, Social_Dwelling, Social_Purpose, Exchange_Unbuilt_Ground, Professional_Purchase, Energy_Efficient_Dwelling, Heritage, Dwelling_For_Social_Renting, Other}
    type Tax_Rate := {1, 2, 4, 6, 7, 10, 12}

    [EN:the registration type] registration_type : () ‚Üí Registration_type
    [EN:the tax rate] tax_rate : () ‚Üí Tax_Rate
    [EN:the tax amount] tax_amount : () ‚Üí ‚Ñù
}

theory environment:environment {
    { professional_buyer() ‚Üê
        professional_declaration_filed()
        ‚àß guarantee_satisfied()
        ‚àß (additional_security_required() ‚àß additional_security_satisfied()
            ‚à® ¬¨additional_security_required())
        ‚àß resale() = Three_Or_More.
    }
}

theory decision:decision {

  [Tax rate legislation]
    {
        [1% tax for Heritage ‚àà Flemish region]
        tax_rate() = 1 ‚Üê registration_type() = Heritage
                         ‚àß region() = Flemish_Region.

        // Correct amount is 1.5
        [2% tax for Social Dwellings ‚àà Flemish region]
        tax_rate() = 2 ‚Üê registration_type() = Social_Dwelling
                         ‚àß region() = Flemish_Region.

        [4% tax for Professional buyers ‚àà Flemish region]
        tax_rate() = 4 ‚Üê registration_type() = Professional_Purchase
                         ‚àß region() = Flemish_Region.

        [6% tax for Energy efficient dwellings, social purpose or exchange unbuilt ground ‚àà Flemish region]
        tax_rate() = 6 ‚Üê (registration_type() = Energy_Efficient_Dwelling
                          ‚à® registration_type() = Social_Purpose
                          ‚à® registration_type() = Exchange_Unbuilt_Ground)
                         ‚àß region() = Flemish_Region.

        [7% tax for family dwelling or dwelling for social renting ‚àà Flemish region]
        tax_rate() = 7 ‚Üê (registration_type() = Family_Dwelling
                           ‚à® registration_type() = Dwelling_For_Social_Renting)
                          ‚àß region() = Flemish_Region.

        [10% default tax ‚àà Flemish region]
        tax_rate() = 10 ‚Üê region() = Flemish_Region
                          ‚àß registration_type() = Other.

        [12% tax ‚àà Brussels and Walloon region]
        tax_rate() = 12 ‚Üê region() = Brussels_Region
                          ‚à® region() = Walloon_Region.
  }

    // registration types currently only defined for Flanders.
    // When a choice is made for walonia or brussels, types can still be entered with a view to expandability

    [An Heritage is a residential monument ‚àà an heritage plan (with additional terms), used as family dwelling]
    registration_type() = Heritage ‚áí type_of_real_estate() = Residential
                                     ‚àß monument()
                                     ‚àß use() = As_Family_Dwelling
                                     ‚àß heritage_investment()
                                     ‚àß heritage_plan()
                                     ‚àß additional_terms().

    [A social dwelling is a residential real estate sold by Vlaamse_Mpy_Voor_Sociaal_Wonen or Erkende_Sociale_Huisvestings_Mpy to a natural person for social housing with a mortgage allowance]
    registration_type() = Social_Dwelling ‚áí buyer() = Natural_Person
                                            ‚àß type_of_real_estate() = Residential
                                            ‚àß use() = Social_Housing
                                            ‚àß (seller() = Vlaamse_Mpy_Voor_Sociaal_Wonen ‚à® seller() = Erkende_Sociale_Huisvestings_Mpy)
                                            ‚àß mortgage_loan_allowance().

    [A Professional purchase is a non-public sale to a professional buyer for resale with a certification not older than 8 years]
    registration_type() = Professional_Purchase ‚áí professional_buyer()
                                                  ‚àß transaction_type() ‚â† Public_Sale
                                                  ‚àß use() = For_Resale
                                                  ‚àß certification_date_sale() = certification_date() + 8.

    registration_type() = Energy_Efficient_Dwelling ‚áí type_of_real_estate() = Residential
                                                      ‚àß buyer() = Natural_Person
                                                      ‚àß domicile_established()
                                                      ‚àß clean_purchase()
                                                      ‚àß (first_ownership() ‚à® causal_connection())
                                                      ‚àß energy_renovation_planned()
                                                      ‚àß term_energy_renovation() = certification_date() + 5.

    [A sale by the Vlaams Woning Fonds for community purpose is for social purpose.]
    registration_type() = Social_Purpose ‚áí (seller() = Mpy_Erkend_Door_VMSW
                                            ‚à® seller() = Vlaams_Woningfonds
                                            ‚à® seller() = Gelijksoortige_Rechtspersoon_EER)
                                           ‚àß use() = Community_Purpose.

    registration_type() = Exchange_Unbuilt_Ground ‚áí additional_terms()
                                                    ‚àß ¬¨monument().

    registration_type() = Family_Dwelling ‚áí type_of_real_estate() = Residential
                                            ‚àß buyer() = Natural_Person
                                            ‚àß domicile_established()
                                            ‚àß clean_purchase()
                                            ‚àß (first_ownership() ‚à® causal_connection())
                                            ‚àß (¬¨energy_renovation_planned() ‚à® term_energy_renovation() ‚â† certification_date() + 5).

    registration_type() = Dwelling_For_Social_Renting ‚áí type_of_real_estate() = Residential
                                                        ‚àß use() = Social_Renting
                                                        ‚àß start_dt_dwelling_for_social_rent() = certification_date() + 3
                                                        ‚àß duration_of_agreement() = Less_Than_9_years.

    // @EXPLAIN: registration_type cannot be Other
    registration_type() = Other ‚áí registration_type() ‚â† Family_Dwelling
                                  ‚àß registration_type() ‚â† Social_Dwelling
                                  ‚àß registration_type() ‚â† Energy_Efficient_Dwelling
                                  ‚àß registration_type() ‚â† Dwelling_For_Social_Renting
                                  ‚àß registration_type() ‚â† Heritage
                                  ‚àß registration_type() ‚â† Professional_Purchase
                                  ‚àß registration_type() ‚â† Social_Purpose
                                  ‚àß registration_type() ‚â† Exchange_Unbuilt_Ground.

    tax_amount() = value() ‚®Ø tax_rate() / 100.

}
structure default:environment {
    region := Flemish_Region.
}
display {
    goal_symbol := {`tax_amount}.
    view() = normal.
    expand := {`registration_type, `tax_rate}.
    heading(Building, `region, `type_of_real_estate, `monument).
    heading(Buyer, `buyer, `domicile_established, `first_ownership,
      `causal_connection, `professional_buyer, `professional_declaration_filed,
      `guarantee_satisfied, `additional_security_required,
      `additional_security_satisfied).
    heading('Sales Transaction', `seller, `value, `transaction_type, `use, `resale,
      `heritage_investment, `heritage_plan, `additional_terms,
      `mortgage_loan_allowance, `certification_date, `certification_date_sale, `clean_purchase,
      `energy_renovation_planned, `term_energy_renovation, `start_dt_dwelling_for_social_rent,
      `duration_of_agreement).
    heading(Registration, `registration_type, `tax_rate, `tax_amount).
    unit('%', `tax_rate).
}
