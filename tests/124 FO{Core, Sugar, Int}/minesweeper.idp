vocabulary V {
    // we use an extended square to simplify computations:
    // we add a 1-cell-wide border without mine

    Range : Int -> Bool
    type Count := {0..8}
    max: () â†’ â„¤  // largest index of column / row
    type PseudoBol := {0,1}
    has_mine: Range â¨¯ Range â†’ PseudoBol
    count: Range â¨¯ Range â†’ Count
    clicked: Range â¨¯ Range â†’ ğ”¹
    shown: Range â¨¯ Range â†’ ğ”¹
}

theory T:V {

    // borders don't have mine
    âˆ€c âˆˆ Range: has_mine(c,0    )=0 âˆ§ has_mine(0    ,c)=0
               âˆ§ has_mine(c,max())=0 âˆ§ has_mine(max(),c)=0.

    // computation of count
    âˆ€r,c âˆˆ Range: count(r,c) =
        (if r=<0 âˆ¨ r>=max() âˆ¨ c=<0 âˆ¨ c>=max() then
            0 // not meaningful because out of bound
        else
            ( has_mine(r,c)

            + has_mine(r-1, c-1)
            + has_mine(r-1, c  )
            + has_mine(r-1, c+1)

            + has_mine(r+1, c-1)
            + has_mine(r+1, c  )
            + has_mine(r+1, c+1)

            + has_mine(r, c-1)
            + has_mine(r, c+1))).

    // what is shown is determined by clicked
    { âˆ€ r, c âˆˆ Range: shown(r,c) â†  // clicked is shown
        Â¬(r=<0 âˆ¨ r>=max() âˆ¨ c=<0 âˆ¨ c>=max())  // unless out of bound
        âˆ§ clicked(r,c).
      âˆ€ r, c âˆˆ Range: shown(r,c) â†  // neighbours of shown 0 are shown
        Â¬(r=<0 âˆ¨ r>=max() âˆ¨ c=<0 âˆ¨ c>=max())  // but borders are not shown
        âˆ§ ( (shown(r-1,c-1) & count(r-1,c-1)=0)
          âˆ¨ (shown(r-1,c+1) & count(r-1,c+1)=0)
          âˆ¨ (shown(r+1,c-1) & count(r+1,c-1)=0)
          âˆ¨ (shown(r+1,c+1) & count(r+1,c+1)=0)
          âˆ¨ (shown(r-1,c  ) & count(r-1,c  )=0)
          âˆ¨ (shown(r+1,c  ) & count(r+1,c  )=0)
          âˆ¨ (shown(r  ,c-1) & count(r  ,c-1)=0)
          âˆ¨ (shown(r  ,c+1) & count(r  ,c+1)=0)
          ).
    }
}

structure S:V {
Range := {0..2}.
    max := 2.
}

procedure main() {
    // t = Theory(T,S,extended=True)
    // pretty_print(t.propagate(T,S))
    pretty_print(model_propagate(T,S,complete=True))
}
